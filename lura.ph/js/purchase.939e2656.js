(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["purchase"],{"05ce":function(t,e,a){"use strict";a("1baa")},"05dd":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Dashboard",{attrs:{name:"Purchase Plans",current:"Purchase"}},[a("div",{attrs:{id:"purchase"}},[a("PurchaseModal",{attrs:{modalOpen:t.openPurchase,planName:t.planName,planPrice:t.planPrice,planType:t.planType},on:{modalClosed:function(e){t.openPurchase=!1}}}),a("UserPurchase",{staticClass:"user-purchases"}),a("div",{staticClass:"payment-info"},[a("div",{staticClass:"plan",class:[t.expanded?"expanded":""]},[a("div",{staticClass:"content"},[a("div",{staticClass:"header"},[a("h3",[t._v("Your Plan Includes:")]),t.expanded?t._e():a("button",{on:{click:t.expandPlan}},[t._v(" Expand + ")])]),t.expanded?a("div",{staticClass:"content"},[a("p",t._l(t.currentPlan.info,(function(e,n){return a("span",{key:n},[t._v(" "+t._s(e)+" ")])})),0)]):t._e()]),t.expanded?a("div",{staticClass:"actions"},[a("button",{on:{click:function(e){return t.startPurchase(t.plans[0])}}},[t._v("Purchase Tokens +")])]):t._e()]),a("div",{staticClass:"additional-plans",class:[t.expanded?"":"expanded"]},[a("h3",[t._v("You can add:")]),a("div",{staticClass:"plans"},t._l(t.getSaleAdditions,(function(e,n){return a("div",{key:n,class:t.displayInfo===e.title?"selected":""},[a("svg-icon",{staticClass:"icon",attrs:{icon:e.icon}}),a("span",{staticClass:"title"},[t._v("Luraph "+t._s(e.title))]),a("span",{staticClass:"cost"},[t._v(t._s(e.cost)+" / "+t._s(e.costType))]),t.displayInfo===e.title?a("div",{staticClass:"infos"},t._l(e.info,(function(e,n){return a("span",{key:n},[t._v(" "+t._s(e)+" ")])})),0):t._e(),a("button",{staticClass:"buy",on:{click:function(a){return t.startPurchase(e)}}},[t._v("Purchase Plan +")]),a("button",{staticClass:"info",class:[t.displayInfo===e.title?"active":""],on:{click:function(a){return t.infoClick(e)}}},[t._v(" "+t._s(t.displayInfo===e.title?"x":"i")+" ")])],1)})),0)])])],1)])},s=[],i=(a("4de4"),a("7db0"),a("5530")),r=a("2f62"),o=a("4129"),c=a("ce4f"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("modal",{attrs:{modalOpen:t.modalOpen,hideSelf:t.hideModel,loading:t.loading},on:{modalClosed:this.modalClosed},scopedSlots:t._u([{key:"banner",fn:function(){return[a("h4",[t._v("Luraph "+t._s(t.planName))]),a("h1",{staticClass:"money"},[t._v(t._s(t.planPrice)+" / "+t._s(t.planType))])]},proxy:!0}])},[a("div",{attrs:{id:"purchase"}},[t.listCard||t.setupCard||!t.loading?t._e():a("div",{staticClass:"form loading"},[a("Loader")],1),a("div",{staticClass:"form list",class:t.isOpen(t.listCard&&!t.setupCard&&!t.success)},["usage"===t.planType?a("FormInput",{attrs:{name:"Usage Quantity",type:"number",fullWidth:"",min:"1"},model:{value:t.quantity,callback:function(e){t.quantity=e},expression:"quantity"}}):t._e(),a("FormInput",{staticClass:"last",attrs:{name:"Promocode",fullWidth:""},model:{value:t.promocode,callback:function(e){t.promocode=e},expression:"promocode"}}),a("CardList",{attrs:{selectedCard:this.selectedCard,shouldFetchCards:t.setupCard&&!t.listCard},on:{loading:this.cardListLoading,loadingFinished:this.cardListLoadFinished,selectedCard:this.selectCard,removedCard:this.removeCard,loadedSelected:this.showCardListSelected}}),a("button",{staticClass:"new-card",on:{click:t.showNewCard}},[a("svg-icon",{staticClass:"icon",attrs:{icon:"icons/plus_icon"}}),a("span",[t._v("Add New Card")])],1),""!==t.error?a("span",{staticClass:"payment-error"},[t._v(" Error: "+t._s(t.error)+" ")]):t._e(),a("button",{attrs:{disabled:null===this.selectedCard},on:{click:t.pay}},[t._v(" "+t._s("usage"===t.planType?"Pay Now":"Subscribe To Plan")+" ")]),a("footer",[t._v(" By purchasing Luraph, you agree to Luraph's Terms and Conditions ")])],1),!t.setupCard||t.listCard||t.success?t._e():a("div",{staticClass:"form open"},[a("CardAdd",{on:{errorLoading:this.modalClosed,loading:function(e){t.loading=!0},loadingFinished:function(e){t.loading=!1},cardAdded:t.cardAdded}}),a("footer",[t._v(" By purchasing Luraph, you agree to Luraph's Terms and Conditions ")])],1),t.success?a("div",{staticClass:"form success open"},[a("div",{staticClass:"header"},[a("svg-icon",{attrs:{icon:"icons/check_circle_icon"}}),a("h2",[t._v("Payment Success!")])],1),"usage"!==t.planType?a("span",{staticClass:"padding"},[t._v(" Your account has been upgraded to: "),a("span",{staticClass:"epic-text"},[t._v("Luraph "+t._s(t.planName))])]):t._e(),"usage"===t.planType?a("span",[a("span",{staticClass:"epic-text"},[t._v(t._s(t.currentTokens)+" Tokens")]),t._v(" You should now have extra token(s) in your Luraph account! ")]):t._e(),a("button",{on:{click:this.modalClosed}},[t._v(" Okay ")]),a("footer",[t._v(" If your account has not been upgraded, or you havent received any usages then "),a("a",{attrs:{href:"/"}},[t._v("please contact support")])])]):t._e()])])},d=[],u=(a("a9e3"),a("96cf"),a("1da1")),p=a("a0a3"),h=a("a0de"),f=a("7b94"),v=a("555f"),m=a("b0b7"),C={name:"Purchase",components:{FormInput:p["a"],CardList:h["a"],CardAdd:f["a"],Loader:v["a"]},props:{modalOpen:Boolean,planName:String,planType:String,planPrice:Number},computed:Object(i["a"])(Object(i["a"])({},Object(r["d"])(["config"])),Object(r["c"])(["tokens"])),watch:{modalOpen:function(t,e){var a=this;if(!0===t){var n=this.config.stripe,s=function(t){alert("Error: ".concat(t)),a.modalClosed(!0)};if(!window.Stripe)return s("Stripe is not loaded, please refresh and try again!");if(!n||""===n)return s("Failed to fetch stripe information from config, please refresh and try again later!");if(!this.stripe&&(this.stripe=window.Stripe(n),!this.stripe))return s("Failed to fetch stripe information from config, please refresh and try again later!");this.showCardList()}this.currentTokens=this.tokens,this.quantity="1",this.modalOpen=t}},methods:{isOpen:function(t){return[t?"open":""]},showCardList:function(){this.success=!1,this.listCard=!0,this.setupCard=!1},showNewCard:function(){this.success=!1,this.listCard=!1,this.setupCard=!0},showSuccess:function(){var t=this;this.currentTokens+=Number(this.quantity),this.listCard=!1,this.setupCard=!1,this.success=!0,this.$confetti.remove(),this.$confetti.start({defaultType:"rect"}),setTimeout((function(){t.$confetti.stop(),setTimeout((function(){document.getElementById("confetti-canvas").remove()}),2e3)}),2e3)},cardAdded:function(t){console.log("got new card",t),this.selectedCard=t},cardListLoading:function(){this.loading=!0},cardListLoadFinished:function(t){null===t?(alert("Error: failed to fetch card list, please retry again in a bit."),this.$emit("modelClosed")):(this.listCard=t.length>0,this.setupCard=!this.listCard,this.loading=!1)},showCardListSelected:function(){this.showCardList(),this.loading=!1},removeCard:function(t){this.selectedCard===t&&(this.selectedCard=null)},selectCard:function(t){this.selectedCard=t},modalClosed:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!t&&this.loading||(this.selectedCard=null,this.$emit("modalClosed"),this.showCardList())},pay:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var a,n,s,i,r,o,c,l,d,u,p,h,f,v,C;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.stripe,s=t.loading,i=t.planName,r=t.planType,o=t.selectedCard,c=t.quantity,l=t.promocode,!0!==s&&o&&n){e.next=3;break}return e.abrupt("return");case 3:if(t.loading=!0,t.error="","usage"!==r){e.next=11;break}if(a=Number(c),!(isNaN(a)||a<1)){e.next=11;break}return t.error="Invalid quantity provided",t.loading=!1,e.abrupt("return");case 11:return e.prev=11,e.next=14,m["a"].purchasePlanAsync(i,o,a,l);case 14:if(d=e.sent,u=d.data,p=u.confirmRequired,h=u.paymentIntent,!p){e.next=30;break}if(h){e.next=20;break}throw new Error("Invalid response from server");case 20:return e.next=22,n.confirmCardPayment(h,{payment_method:o});case 22:if(f=e.sent,v=f.error,C=f.paymentIntent,!v){e.next=29;break}throw v;case 29:console.log("paymentIntent",C);case 30:t.showSuccess(),e.next=38;break;case 33:e.prev=33,e.t0=e["catch"](11),t.error=e.t0.message,t.loading=!1,console.error("error",e.t0);case 38:case"end":return e.stop()}}),e,null,[[11,33]])})))()}},data:function(){return{error:"",promocode:"",quantity:"1",currentTokens:this.tokens,loading:!0,hideModel:!1,listCard:!1,setupCard:!1,success:!1,selectedCard:null,stripe:null}}},g=C,y=(a("b903"),a("2877")),_=Object(y["a"])(g,l,d,!1,null,"0b8b692d",null),b=_.exports,P={name:"Purchase",components:{Dashboard:o["a"],UserPurchase:c["a"],PurchaseModal:b},computed:Object(i["a"])({getSaleAdditions:function(){var t=this;return this.plans.filter((function(e){return e.title!==t.user.plan.capitalize()}))},currentPlan:function(){var t=this;return this.plans.find((function(e){return e.title===t.user.plan.capitalize()}))}},Object(r["d"])(["user"])),methods:{expandPlan:function(){this.displayInfo="",this.expanded=!0},infoClick:function(t){console.log(t),this.displayInfo===t.title?(this.displayInfo="",this.expanded=!0):(this.displayInfo=t.title,this.expanded=!1)},startPurchase:function(t){this.planName=t.title,this.planPrice=t.cost,this.planType=t.costType,this.openPurchase=!0}},data:function(){return{planName:"",planType:"",planPrice:0,openPurchase:!1,expanded:!0,displayInfo:"",plans:this.$config.plans}}},k=P,w=(a("05ce"),Object(y["a"])(k,n,s,!1,null,"ba18ca5e",null));e["default"]=w.exports},"1baa":function(t,e,a){},"50e0":function(t,e,a){},"59cf":function(t,e,a){"use strict";a("9a78")},"7db0":function(t,e,a){"use strict";var n=a("23e7"),s=a("b727").find,i=a("44d2"),r=a("ae40"),o="find",c=!0,l=r(o);o in[]&&Array(1)[o]((function(){c=!1})),n({target:"Array",proto:!0,forced:c||!l},{find:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),i(o)},"9a78":function(t,e,a){},b903:function(t,e,a){"use strict";a("50e0")},ce4f:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"user-purchase"}},[a("h3",[t._v("Purchases")]),a("div",{staticClass:"payment-plan"},[a("svg-icon",{attrs:{icon:this.currentPlanIcon}}),a("span",[t._v("Luraph "+t._s(this.user.plan.capitalize()))]),a("h2",[t._v(t._s(this.currentPlanPrice)+" / "+t._s(this.currentPlanUsage))]),a("router-link",{attrs:{to:{name:"Account",params:{showBillingInfo:!0}}}},[t._v(" Billing info + ")])],1),a("div",{staticClass:"payments"},[a("span",[t._v("Monthly Billing")]),a("div",{staticClass:"scroller"},[t._l(t.invoices,(function(e,n){return a("div",{key:n,staticClass:"payment"},[a("div",{staticClass:"top"},[a("h4",[t._v(t._s(t.getDate(e)))]),a("span",[t._v(t._s(t.getPrice(e)))])]),a("span",[t._v(t._s(e.name))])])})),t.invoices.length<1&&!t.loading?a("div",{staticClass:"empty"},[a("svg-icon",{attrs:{icon:"icons/sad_cry"}}),a("span",[t._v("There are no invoices here!")])],1):t._e(),t.loading?a("div",{staticClass:"loader"},[a("Loader")],1):t._e()],2)]),a("div",{staticClass:"actions"},[a("button",{staticClass:"load-more",attrs:{disabled:t.loading||t.endOfHistory},on:{click:t.loadInvoiceList}},[t._v(" "+t._s(t.endOfHistory?"END OF HISTORY":"Purchases +")+" ")])])])},s=[],i=(a("99af"),a("7db0"),a("96cf"),a("1da1")),r=a("5530"),o=a("2f62"),c=a("555f"),l=a("b0b7"),d=a("a9dc"),u={name:"UserPurchases",components:{Loader:c["a"]},computed:Object(r["a"])({currentPlanPrice:function(){var t=this.currentPlan;return t?t.cost:0},currentPlanIcon:function(){var t=this.currentPlan;return t?t.icon:""},currentPlanUsage:function(){var t=this.currentPlan;return t?t.costType:""},currentPlan:function(){var t=this;return this.plans.find((function(e){return e.title===t.user.plan.capitalize()}))}},Object(o["d"])(["user"])),methods:{loadInvoiceList:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.invoices,t.loading=!0,e.prev=2,e.next=5,l["a"].fetchInvoicesAsync(a.length);case 5:if(e.t0=e.sent.data,e.t0){e.next=8;break}e.t0={};case 8:n=e.t0,s=n.invoices,t.invoices=a.concat(s),s.length<1&&(t.endOfHistory=!0),console.log(s),e.next=18;break;case 15:e.prev=15,e.t1=e["catch"](2),alert("Error: failed to fetch invoices");case 18:t.loading=!1;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})))()},getDate:function(t){return d["a"].getFormattedDate(t.timestamp)},getPrice:function(t){return(t.price/100||0).toLocaleString("en-US",{style:"currency",currency:"USD"}).substr(1)}},created:function(){this.loadInvoiceList()},data:function(){return{invoices:[],loading:!1,endOfHistory:!1,plans:this.$config.plans}}},p=u,h=(a("59cf"),a("2877")),f=Object(h["a"])(p,n,s,!1,null,"b3c9046e",null);e["a"]=f.exports}}]);